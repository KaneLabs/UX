var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard");Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var React=_interopRequireWildcard(require("react"));var _reactNative=require("react-native");var _Container=_interopRequireDefault(require("../components/Container"));var _TextField=_interopRequireDefault(require("../components/TextField"));var _Button=_interopRequireDefault(require("../components/Button"));var _Auth=require("../queries/Auth");var _client=require("@apollo/client");var _native=require("@react-navigation/native");var _this=this,_jsxFileName="/Users/kane/Lab/Eros/src/screens/AuthPhoneVerify.tsx";var AuthenticatePhone=function AuthenticatePhone(_ref){var onSuccess=_ref.onSuccess;var navigation=(0,_native.useNavigation)();var _React$useState=React.useState(''),_React$useState2=(0,_slicedToArray2.default)(_React$useState,2),code=_React$useState2[0],setCode=_React$useState2[1];var inputRef=React.useRef(null);var _useQuery=(0,_client.useQuery)(_Auth.ME),refetch=_useQuery.refetch,data=_useQuery.data,client=_useQuery.client;var _useMutation=(0,_client.useMutation)(_Auth.AUTH_PHONE_VERIFY),_useMutation2=(0,_slicedToArray2.default)(_useMutation,2),verifyCode=_useMutation2[0],verifyCodeData=_useMutation2[1];(0,_native.useFocusEffect)(React.useCallback(function(){var _inputRef$current;inputRef==null?void 0:(_inputRef$current=inputRef.current)==null?void 0:_inputRef$current.focus();return function(){setCode('');};},[refetch]));var submitCode=React.useCallback(function _callee(){var _response$data,_response$data$AuthPh;var phone,input,response,token;return _regenerator.default.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:console.log({data:data});_context.next=3;return _regenerator.default.awrap(_reactNative.AsyncStorage.getItem('phone'));case 3:phone=_context.sent;input={phone:phone,code:code};_context.next=7;return _regenerator.default.awrap(verifyCode({variables:{input:input}}));case 7:response=_context.sent;token=response==null?void 0:(_response$data=response.data)==null?void 0:(_response$data$AuthPh=_response$data.AuthPhoneVerify)==null?void 0:_response$data$AuthPh.token;console.log({token:token});if(!token){_context.next=17;break;}_context.next=13;return _regenerator.default.awrap(_reactNative.AsyncStorage.setItem('token',token));case 13:_context.next=15;return _regenerator.default.awrap(client.resetStore());case 15:onSuccess&&onSuccess(response.data.AuthPhoneVerify);navigation.navigate('Map');case 17:case"end":return _context.stop();}}},null,null,null,Promise);},[code,verifyCode,onSuccess,navigation,refetch]);return React.createElement(_Container.default,{center:true,style:{marginVertical:80},__self:_this,__source:{fileName:_jsxFileName,lineNumber:55,columnNumber:5}},React.createElement(_reactNative.View,{style:{flex:1,alignSelf:'center',padding:40},__self:_this,__source:{fileName:_jsxFileName,lineNumber:60,columnNumber:7}},React.createElement(_TextField.default,{ref:inputRef,keyboardType:'phone-pad',value:code,onChangeText:setCode,placeholder:'Enter Code',__self:_this,__source:{fileName:_jsxFileName,lineNumber:61,columnNumber:9}}),React.createElement(_Button.default,{onPress:submitCode,text:"Submit",__self:_this,__source:{fileName:_jsxFileName,lineNumber:68,columnNumber:9}})));};var _default=AuthenticatePhone;exports.default=_default;