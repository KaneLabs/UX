var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard");Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var React=_interopRequireWildcard(require("react"));var _reactNative=require("react-native");var _Container=_interopRequireDefault(require("../components/Container"));var _TextField=_interopRequireDefault(require("../components/TextField"));var _Button=_interopRequireDefault(require("../components/Button"));var _Row=_interopRequireDefault(require("../components/Layout/Row"));var _Auth=require("../queries/Auth");var _client=require("@apollo/client");var _native=require("@react-navigation/native");var _countryData=_interopRequireDefault(require("../components/CountryCodeMenu/country-data"));var _this=this,_jsxFileName="/Users/kane/Lab/Eros/src/screens/AuthPhone.tsx";console.log({AUTH_PHONE:_Auth.AUTH_PHONE,ME:_Auth.ME});var AuthPhone=function AuthPhone(_ref){var route=_ref.route;var navigation=(0,_native.useNavigation)();var _React$useState=React.useState(''),_React$useState2=(0,_slicedToArray2.default)(_React$useState,2),phone=_React$useState2[0],setPhone=_React$useState2[1];var inputRef=React.useRef(null);var _useQuery=(0,_client.useQuery)(_Auth.ME),refetch=_useQuery.refetch,loading=_useQuery.loading,data=_useQuery.data,error=_useQuery.error,called=_useQuery.called,client=_useQuery.client;var _useMutation=(0,_client.useMutation)(_Auth.AUTH_PHONE),_useMutation2=(0,_slicedToArray2.default)(_useMutation,2),authPhone=_useMutation2[0],authPhoneData=_useMutation2[1];console.log({route:route});var _React$useState3=React.useState(_countryData.default.find(function(country){return(country==null?void 0:country.key)==='US';})),_React$useState4=(0,_slicedToArray2.default)(_React$useState3,2),selectedCountry=_React$useState4[0],setSelectedCountry=_React$useState4[1];(0,_native.useFocusEffect)(React.useCallback(function(){var _route$params,_route$params2,_route$params2$countr,_inputRef$current;called&&refetch();if(route!=null&&(_route$params=route.params)!=null&&_route$params.country&&(selectedCountry==null?void 0:selectedCountry.key)!==(route==null?void 0:(_route$params2=route.params)==null?void 0:(_route$params2$countr=_route$params2.country)==null?void 0:_route$params2$countr.key)){var _route$params3;setSelectedCountry(route==null?void 0:(_route$params3=route.params)==null?void 0:_route$params3.country);}inputRef==null?void 0:(_inputRef$current=inputRef.current)==null?void 0:_inputRef$current.focus();return function(){setPhone('');};},[refetch,route==null?void 0:route.params]));var submitPhone=React.useCallback(function _callee(){var _response$data;var phoneString,response,success;return _regenerator.default.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:phoneString="+"+(selectedCountry==null?void 0:selectedCountry.phone)+phone;console.log({phoneString:phoneString});_context.next=4;return _regenerator.default.awrap(authPhone({variables:{input:{phone:phoneString}}}));case 4:response=_context.sent;success=(response==null?void 0:(_response$data=response.data)==null?void 0:_response$data.AuthPhone)==='We sent you a code.';if(!success){_context.next=10;break;}_context.next=9;return _regenerator.default.awrap(_reactNative.AsyncStorage.setItem('phone',phoneString));case 9:navigation.navigate('AuthPhoneVerify');case 10:case"end":return _context.stop();}}},null,null,null,Promise);},[authPhone,phone]);return React.createElement(_Container.default,{center:true,__self:_this,__source:{fileName:_jsxFileName,lineNumber:74,columnNumber:5}},React.createElement(_reactNative.View,{style:{flex:1,alignSelf:'center',margin:40,marginVertical:80},__self:_this,__source:{fileName:_jsxFileName,lineNumber:75,columnNumber:7}},React.createElement(_Row.default,{fullWidth:true,style:{padding:20,paddingRight:40},__self:_this,__source:{fileName:_jsxFileName,lineNumber:82,columnNumber:9}},React.createElement(_Button.default,{style:{paddingHorizontal:8},text:"+"+(selectedCountry==null?void 0:selectedCountry.phone)+" "+(selectedCountry==null?void 0:selectedCountry.emoji)+" ",onPress:function onPress(){return navigation.navigate('CountryCode');},__self:_this,__source:{fileName:_jsxFileName,lineNumber:83,columnNumber:11}}),React.createElement(_TextField.default,{keyboardType:'phone-pad',style:{width:'100%'},ref:inputRef,value:phone,onChangeText:setPhone,placeholder:'Enter Phone',__self:_this,__source:{fileName:_jsxFileName,lineNumber:88,columnNumber:11}})),React.createElement(_Button.default,{disabled:loading,onPress:submitPhone,text:"Submit",__self:_this,__source:{fileName:_jsxFileName,lineNumber:97,columnNumber:9}})));};var _default=AuthPhone;exports.default=_default;