var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard");Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends"));var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var React=_interopRequireWildcard(require("react"));var _components=require("../../components");var _queries=require("../../queries");var _reactHooks=require("@apollo/react-hooks");var _this=this,_jsxFileName="/Users/kane/Lab/Eros/src/containers/Auth/AuthVerifyPhone.tsx";var AuthVerifyPhone=function AuthVerifyPhone(_ref){var onSuccess=_ref.onSuccess;var _React$useState=React.useState(''),_React$useState2=(0,_slicedToArray2.default)(_React$useState,2),phone=_React$useState2[0],setPhone=_React$useState2[1];var _React$useState3=React.useState(''),_React$useState4=(0,_slicedToArray2.default)(_React$useState3,2),verificationCode=_React$useState4[0],setVerificationCode=_React$useState4[1];var _useMutation=(0,_reactHooks.useMutation)(_queries.AUTH_VERIFY_PHONE,{update:function update(cache,_ref2){return function _callee(){var NextMe,_cache$readQuery,Me,_cache$readQuery2,NewMe;return _regenerator.default.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:NextMe=_ref2.data.AuthVerifyPhone;_cache$readQuery=cache.readQuery({query:_queries.ME}),Me=_cache$readQuery.Me;cache.writeQuery({query:_queries.ME,data:{Me:(0,_extends2.default)({},Me,NextMe)}});if(window){document.cookie="token="+NextMe.token;}_cache$readQuery2=cache.readQuery({query:_queries.ME}),NewMe=_cache$readQuery2.Me;console.log({NewMe:NewMe});onSuccess(NewMe);case 7:case"end":return _context.stop();}}},null,null,null,Promise);}();}}),_useMutation2=(0,_slicedToArray2.default)(_useMutation,2),verifyPhone=_useMutation2[0],_useMutation2$=_useMutation2[1],data=_useMutation2$.data,error=_useMutation2$.error,loading=_useMutation2$.loading;var submit=function submit(){var input,response;return _regenerator.default.async(function submit$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:input={verificationCode:verificationCode,phone:phone};console.log(input);_context2.next=4;return _regenerator.default.awrap(verifyPhone({variables:{input:input}}));case 4:response=_context2.sent;console.log(response);case 6:case"end":return _context2.stop();}}},null,null,null,Promise);};return React.createElement(_components.Container,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:45,columnNumber:5}},React.createElement(_components.Typography,{type:"h2",text:"Enter your verification code.",__self:_this,__source:{fileName:_jsxFileName,lineNumber:46,columnNumber:7}}),error&&error.message&&React.createElement(_components.Typography,{type:"subtitle1",testID:"AuthVerifyPhoneError",text:error.message,gutter:true,__self:_this,__source:{fileName:_jsxFileName,lineNumber:48,columnNumber:9}}),React.createElement(_components.TextField,{value:verificationCode,onChangeText:setVerificationCode,__self:_this,__source:{fileName:_jsxFileName,lineNumber:50,columnNumber:7}}),React.createElement(_components.TextField,{value:phone,onChangeText:setPhone,__self:_this,__source:{fileName:_jsxFileName,lineNumber:51,columnNumber:7}}),React.createElement(_components.OutlinedButton,{onPress:submit,__self:_this,__source:{fileName:_jsxFileName,lineNumber:52,columnNumber:7}}));};var _default=AuthVerifyPhone;exports.default=_default;