var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard");Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends"));var _react=_interopRequireWildcard(require("react"));var _reactNative=require("react-native");var _reactHooks=require("@apollo/react-hooks");var _queries=require("../../queries");var _theme=require("../../theme");var _libphonenumberJs=require("libphonenumber-js");var _components=require("../../components");var _this=this,_jsxFileName="/Users/kane/Lab/Eros/src/containers/Auth/AuthPhoneOrEmail.tsx";var PHONE_STATE={countryCode:'1',country:'US',phoneNumber:'',friendlyPhoneNumber:'',isPossible:false};var reducer=function reducer(state,action){switch(action.type){case'SET_PHONE_NUMBER':return(0,_extends2.default)({},state,{phoneNumber:action.payload,friendlyPhoneNumber:new _libphonenumberJs.AsYouType(state.country).input(action.payload)});case'SET_IS_POSSIBLE':return(0,_extends2.default)({},state,{isPossible:action.payload});default:throw new Error("Action Type: "+action.type+" not found");}};var useSetPhoneMutation=function useSetPhoneMutation(){var client=(0,_reactHooks.useApolloClient)();var _useMutation=(0,_reactHooks.useMutation)(_queries.SET_PHONE,{onCompleted:function onCompleted(_ref){var phone=_ref.SetPhone;console.log('onCompleted phone',phone);client.writeQuery({query:_queries.PHONE,data:{Phone:(0,_extends2.default)({},phone)}});}}),_useMutation2=(0,_slicedToArray2.default)(_useMutation,2),setPhone=_useMutation2[0],state=_useMutation2[1];return[setPhone,state];};var AuthPhoneOrEmail=function AuthPhoneOrEmail(_ref2){var _ref2$onSuccess=_ref2.onSuccess,onSuccess=_ref2$onSuccess===void 0?function(){return null;}:_ref2$onSuccess,handle=_ref2.handle,_ref2$onCountryCodePr=_ref2.onCountryCodePress,onCountryCodePress=_ref2$onCountryCodePr===void 0?function(){return null;}:_ref2$onCountryCodePr,_ref2$onNext=_ref2.onNext,onNext=_ref2$onNext===void 0?function(){return null;}:_ref2$onNext,_ref2$initialState=_ref2.initialState,initialState=_ref2$initialState===void 0?PHONE_STATE:_ref2$initialState;var styles=useStyles();var cachedMe=(0,_reactHooks.useQuery)(_queries.ME,{fetchPolicy:'cache-only'});console.log('cachedMe',cachedMe);var _useState=(0,_react.useState)(''),_useState2=(0,_slicedToArray2.default)(_useState,2),phoneOrEmail=_useState2[0],setPhoneOrEmail=_useState2[1];var client=(0,_reactHooks.useApolloClient)();var _useMutation3=(0,_reactHooks.useMutation)(_queries.AUTH_PHONE_OR_EMAIL,{onCompleted:function onCompleted(_ref3){var AuthPhoneOrEmail=_ref3.AuthPhoneOrEmail;console.log('onCompleted',AuthPhoneOrEmail);return AuthPhoneOrEmail&&onSuccess&&onSuccess(AuthPhoneOrEmail);}}),_useMutation4=(0,_slicedToArray2.default)(_useMutation3,2),authPhoneOrEmail=_useMutation4[0],_useMutation4$=_useMutation4[1],data=_useMutation4$.data,error=_useMutation4$.error,loading=_useMutation4$.loading;var handlePhone=function handlePhone(next){setPhoneOrEmail(next);};var submit=function submit(){var _await$authPhoneOrEma,_data,_error;return _regenerator.default.async(function submit$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return _regenerator.default.awrap(authPhoneOrEmail({variables:{phoneOrEmail:phoneOrEmail}}));case 3:_await$authPhoneOrEma=_context.sent;_data=_await$authPhoneOrEma.data;_error=_await$authPhoneOrEma.error;console.log({data:_data,error:_error});_context.next=12;break;case 9:_context.prev=9;_context.t0=_context["catch"](0);console.log('handlePhone catch',_context.t0.message);case 12:case"end":return _context.stop();}}},null,null,[[0,9]],Promise);};return _react.default.createElement(_reactNative.View,{style:{width:'100%'},testID:"AuthPhoneOrEmail",__self:_this,__source:{fileName:_jsxFileName,lineNumber:135,columnNumber:5}},_react.default.createElement(_components.Subtitle,{text:"Enter Phone or Email",gutter:true,__self:_this,__source:{fileName:_jsxFileName,lineNumber:136,columnNumber:7}}),_react.default.createElement(_components.Row,{center:true,style:styles.row,__self:_this,__source:{fileName:_jsxFileName,lineNumber:137,columnNumber:7}},_react.default.createElement(_reactNative.View,{style:styles.textFieldContainer,__self:_this,__source:{fileName:_jsxFileName,lineNumber:138,columnNumber:9}},_react.default.createElement(_components.TextField,{testID:"AuthPhoneOrEmailInput",style:styles.textField,autoFocus:true,keyboardAppearance:"dark",label:"phone",onChangeText:handlePhone,value:phoneOrEmail,__self:_this,__source:{fileName:_jsxFileName,lineNumber:139,columnNumber:11}}))),error&&error.message&&_react.default.createElement(_components.Subtitle,{testID:"AuthPhoneOrEmailError",text:error.message,gutter:true,__self:_this,__source:{fileName:_jsxFileName,lineNumber:151,columnNumber:9}}),loading&&_react.default.createElement(_components.ActivityIndicator,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:153,columnNumber:19}}),_react.default.createElement(_components.OutlinedButton,{onPress:submit,__self:_this,__source:{fileName:_jsxFileName,lineNumber:154,columnNumber:7}}));};var useStyles=(0,_theme.makeStyles)(function(theme){return{container:{maxWidth:theme.FEED_WIDTH,padding:theme.NAV_HEIGHT,width:'100%',justifyContent:'center',alignItems:'center'},button:{flex:1,width:'100%'},row:{width:'100%',marginBottom:14},content:{flex:1},textField:{fontSize:21,lineHeight:31,alignItems:'center'},textFieldContainer:{width:'100%',flex:1}};});var _default=AuthPhoneOrEmail;exports.default=_default;