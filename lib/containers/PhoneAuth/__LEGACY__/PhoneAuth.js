var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard");Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends"));var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _react=_interopRequireWildcard(require("react"));var _reactNative=require("react-native");var _reactHooks=require("@apollo/react-hooks");var _queries=require("../../../queries");var _theme=require("../../../theme");var _components=require("../../../components");var _this=this,_jsxFileName="/Users/kane/Lab/Eros/src/containers/PhoneAuth/__LEGACY__/PhoneAuth.js";var INITIAL_STATE={phoneId:0,countryCode:'1',emoji:'ðŸ‡ºðŸ‡¸',number:'',verificationCode:'',status:'NOT_VERIFIED',countryCodeMenuOpen:false};var PhoneAuth=function PhoneAuth(_ref){var onSuccess=_ref.onSuccess,handle=_ref.handle;var _useState=(0,_react.useState)(INITIAL_STATE),_useState2=(0,_slicedToArray2.default)(_useState,2),state=_useState2[0],setState=_useState2[1];var _useMutation=(0,_reactHooks.useMutation)(_queries.SET_PHONE),_useMutation2=(0,_slicedToArray2.default)(_useMutation,1),setPhone=_useMutation2[0];var _useMutation3=(0,_reactHooks.useMutation)(_queries.VERIFY_PHONE),_useMutation4=(0,_slicedToArray2.default)(_useMutation3,1),verifyPhone=_useMutation4[0];var handlePhone=function handlePhone(nextNumber){var input,_await$setPhone,data;return _regenerator.default.async(function handlePhone$(_context){while(1){switch(_context.prev=_context.next){case 0:setState(function(state){return(0,_extends2.default)({},state,{number:nextNumber});});if(!(nextNumber.length===10)){_context.next=19;break;}_context.prev=2;setState(function(state){return(0,_extends2.default)({},state,{loading:true});});input={countryCode:state.countryCode,number:nextNumber};_context.next=7;return _regenerator.default.awrap(setPhone({variables:{input:input}}));case 7:_await$setPhone=_context.sent;data=_await$setPhone.data;console.log('data',data);if(!(data&&data.SetPhone&&data.SetPhone.id)){_context.next=12;break;}return _context.abrupt("return",setState(function(state){return(0,_extends2.default)({},state,{status:'CODE_SENT',phoneId:data.SetPhone.id,loading:false});}));case 12:return _context.abrupt("return",setState(function(state){return(0,_extends2.default)({},state,{loading:false});}));case 15:_context.prev=15;_context.t0=_context["catch"](2);console.log('handlePhone catch',_context.t0.message);return _context.abrupt("return",setState(function(state){return(0,_extends2.default)({},state,{loading:false});}));case 19:case"end":return _context.stop();}}},null,null,[[2,15]],Promise);};var handleCode=function handleCode(nextCode){var countryCode,number,phoneId,input,_await$verifyPhone,data;return _regenerator.default.async(function handleCode$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setState(function(state){return(0,_extends2.default)({},state,{verificationCode:nextCode});});if(!(nextCode.length===6)){_context2.next=18;break;}_context2.prev=2;setState(function(state){return(0,_extends2.default)({},state,{loading:true});});countryCode=state.countryCode,number=state.number,phoneId=state.phoneId;input={id:phoneId,verificationCode:nextCode};_context2.next=8;return _regenerator.default.awrap(verifyPhone({variables:{input:input}}));case 8:_await$verifyPhone=_context2.sent;data=_await$verifyPhone.data;if(!(data&&data.VerifyPhone&&data.VerifyPhone.token)){_context2.next=13;break;}console.log('verify phone account response',data.VerifyPhone);return _context2.abrupt("return",onSuccess(data.VerifyPhone));case 13:_context2.next=18;break;case 15:_context2.prev=15;_context2.t0=_context2["catch"](2);console.log('verifyPhone catch',_context2.t0);case 18:case"end":return _context2.stop();}}},null,null,[[2,15]],Promise);};var styles=useStyles();return _react.default.createElement(_reactNative.View,{style:styles.container,testID:"PhoneAuth",__self:_this,__source:{fileName:_jsxFileName,lineNumber:89,columnNumber:5}},_react.default.createElement(_components.Subtitle,{type:2,text:state.status==='NOT_VERIFIED'?'Enter Phone Number':'Enter Verification Code',gutter:true,__self:_this,__source:{fileName:_jsxFileName,lineNumber:90,columnNumber:7}}),state.status==='NOT_VERIFIED'?_react.default.createElement(_react.default.Fragment,null,_react.default.createElement(_reactNative.View,{style:styles.row,__self:_this,__source:{fileName:_jsxFileName,lineNumber:102,columnNumber:11}},_react.default.createElement(_components.Button,{fontStyle:{fontSize:22,lineHeight:24},text:state.emoji+" "+state.countryCode.toString()+" ",onPress:function onPress(){return setState(function(state){return(0,_extends2.default)({},state,{countryCodeMenuOpen:true});});},__self:_this,__source:{fileName:_jsxFileName,lineNumber:103,columnNumber:13}}),_react.default.createElement(_reactNative.View,{style:styles.textFieldContainer,__self:_this,__source:{fileName:_jsxFileName,lineNumber:109,columnNumber:13}},_react.default.createElement(_components.TextField,{style:styles.textField,autoFocus:true,testID:"PhoneInput",keyboardType:"number-pad",keyboardAppearance:"dark",label:"phone",onChangeText:handlePhone,value:state.number,__self:_this,__source:{fileName:_jsxFileName,lineNumber:110,columnNumber:15}}))),state.countryCodeMenuOpen&&_react.default.createElement(_components.CountryCodeMenu,{setCountryCode:function setCountryCode(countryCode){setState(function(state){return(0,_extends2.default)({},state,{countryCode:countryCode,countryCodeMenuOpen:false});});},close:function close(){return setState(function(state){return(0,_extends2.default)({},state,{countryCodeMenuOpen:false});});},__self:_this,__source:{fileName:_jsxFileName,lineNumber:124,columnNumber:13}})):_react.default.createElement(_reactNative.View,{style:styles.row,__self:_this,__source:{fileName:_jsxFileName,lineNumber:137,columnNumber:9}},_react.default.createElement(_reactNative.View,{style:styles.textFieldContainer,__self:_this,__source:{fileName:_jsxFileName,lineNumber:138,columnNumber:11}},_react.default.createElement(_components.TextField,{style:styles.textField,autoFocus:true,testID:"CodeInput",keyboardType:"number-pad",keyboardAppearance:"dark",label:"code",onChangeText:handleCode,value:state.verificationCode,__self:_this,__source:{fileName:_jsxFileName,lineNumber:139,columnNumber:13}}))));};var useStyles=(0,_theme.makeStyles)(function(theme){return{container:{maxWidth:540,paddingHorizontal:_theme.unit*2.5,paddingVertical:_theme.unit*3.5,width:'100%'},row:{alignItems:'center',flexDirection:'row'},content:{flex:1},textField:{fontSize:22,lineHeight:28,alignItems:'center'},textFieldContainer:{width:'100%',flex:1}};});var _default=PhoneAuth;exports.default=_default;