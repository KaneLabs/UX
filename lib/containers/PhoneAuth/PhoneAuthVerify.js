var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard");Object.defineProperty(exports,"__esModule",{value:true});exports.default=exports.PhoneAuthVerify=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends"));var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _react=_interopRequireWildcard(require("react"));var _View=_interopRequireDefault(require("react-native-web/dist/exports/View"));var _reactHooks=require("@apollo/react-hooks");var _queries=require("../../queries");var _theme=require("../../theme");var _components=require("../../components");var _this=this,_jsxFileName="/Users/kane/Lab/Eros/src/containers/PhoneAuth/PhoneAuthVerify.js";var INITIAL_STATE={phoneId:0,countryCode:'1',emoji:'ðŸ‡ºðŸ‡¸',number:'',verificationCode:'',status:'NOT_VERIFIED',countryCodeMenuOpen:false};var PhoneAuthVerify=function PhoneAuthVerify(_ref){var onSuccess=_ref.onSuccess,_ref$onBack=_ref.onBack,onBack=_ref$onBack===void 0?function(){return null;}:_ref$onBack,handle=_ref.handle;var _useState=(0,_react.useState)(INITIAL_STATE),_useState2=(0,_slicedToArray2.default)(_useState,2),state=_useState2[0],setState=_useState2[1];var styles=useStyles();var _useQuery=(0,_reactHooks.useQuery)(_queries.PHONE),data=_useQuery.data;var phone=data&&data.Phone;var _useMutation=(0,_reactHooks.useMutation)(_queries.VERIFY_PHONE),_useMutation2=(0,_slicedToArray2.default)(_useMutation,2),verifyPhone=_useMutation2[0],_useMutation2$=_useMutation2[1],error=_useMutation2$.error,loading=_useMutation2$.loading;var handleCode=function handleCode(nextCode){var id,input,_await$verifyPhone,_data;return _regenerator.default.async(function handleCode$(_context){while(1){switch(_context.prev=_context.next){case 0:setState(function(state){return(0,_extends2.default)({},state,{verificationCode:nextCode});});if(!(nextCode.length===6)){_context.next=17;break;}_context.prev=2;id=phone.id;input={id:id,verificationCode:nextCode};_context.next=7;return _regenerator.default.awrap(verifyPhone({variables:{input:input}}));case 7:_await$verifyPhone=_context.sent;_data=_await$verifyPhone.data;if(!(_data&&_data.VerifyPhone&&_data.VerifyPhone.token)){_context.next=12;break;}console.log('verify phone account response',_data.VerifyPhone);return _context.abrupt("return",onSuccess(_data.VerifyPhone));case 12:_context.next=17;break;case 14:_context.prev=14;_context.t0=_context["catch"](2);console.log('verifyPhone catch',_context.t0);case 17:case"end":return _context.stop();}}},null,null,[[2,14]],Promise);};var submit=function submit(){var input,_await$verifyPhone2,_data2;return _regenerator.default.async(function submit$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;input={id:phone.id,verificationCode:state.verificationCode};_context2.next=4;return _regenerator.default.awrap(verifyPhone({variables:{input:input}}));case 4:_await$verifyPhone2=_context2.sent;_data2=_await$verifyPhone2.data;if(!(_data2&&_data2.VerifyPhone&&_data2.VerifyPhone.token)){_context2.next=8;break;}return _context2.abrupt("return",onSuccess(_data2.VerifyPhone));case 8:_context2.next=12;break;case 10:_context2.prev=10;_context2.t0=_context2["catch"](0);case 12:case"end":return _context2.stop();}}},null,null,[[0,10]],Promise);};return _react.default.createElement(_react.default.Fragment,null,_react.default.createElement(_View.default,{style:{width:'100%'},testID:"PhoneAuthVerify",__self:_this,__source:{fileName:_jsxFileName,lineNumber:68,columnNumber:7}},_react.default.createElement(_components.Subtitle,{text:"Enter Verification Code",gutter:true,__self:_this,__source:{fileName:_jsxFileName,lineNumber:69,columnNumber:9}}),_react.default.createElement(_View.default,{style:styles.row,__self:_this,__source:{fileName:_jsxFileName,lineNumber:70,columnNumber:9}},_react.default.createElement(_View.default,{style:styles.textFieldContainer,__self:_this,__source:{fileName:_jsxFileName,lineNumber:71,columnNumber:11}},_react.default.createElement(_components.TextField,{style:styles.textField,autoFocus:true,testID:"PhoneAuthVerifyInput",keyboardType:"phone-pad",keyboardAppearance:"dark",label:"code",onChangeText:handleCode,value:state.verificationCode,__self:_this,__source:{fileName:_jsxFileName,lineNumber:72,columnNumber:13}}))),error&&error.message&&_react.default.createElement(_components.Subtitle,{testID:"PhoneAuthVerifyError",text:error.message,gutter:true,__self:_this,__source:{fileName:_jsxFileName,lineNumber:85,columnNumber:11}}),loading&&_react.default.createElement(_components.ActivityIndicator,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:87,columnNumber:21}})),_react.default.createElement(_components.Container,{center:true,__self:_this,__source:{fileName:_jsxFileName,lineNumber:90,columnNumber:7}},_react.default.createElement(_components.OutlinedButton,{disabled:state.verificationCode.length!==6,testID:"PhoneAuthVerifyPrimaryButton",text:"NEXT",onPress:submit,style:{marginBottom:20,width:'100%'},__self:_this,__source:{fileName:_jsxFileName,lineNumber:91,columnNumber:9}}),_react.default.createElement(_components.Button,{testID:"PhoneAuthVerifyBackButton",text:"Back",onPress:onBack,style:{marginBottom:20,width:'100%'},__self:_this,__source:{fileName:_jsxFileName,lineNumber:98,columnNumber:9}})));};exports.PhoneAuthVerify=PhoneAuthVerify;var useStyles=(0,_theme.makeStyles)(function(theme){return{container:{maxWidth:theme.FEED_WIDTH,padding:theme.NAV_HEIGHT},row:{alignItems:'center',flexDirection:'row',marginBottom:theme.unit*1.5},content:{flex:1},textField:{fontSize:22,lineHeight:28,alignItems:'center'},textFieldContainer:{width:'100%',flex:1}};});var _default=PhoneAuthVerify;exports.default=_default;