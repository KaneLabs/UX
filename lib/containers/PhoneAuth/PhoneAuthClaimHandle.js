var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard");Object.defineProperty(exports,"__esModule",{value:true});exports.default=exports.PhoneAuthClaimHandle=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _react=_interopRequireWildcard(require("react"));var _components=require("../../components");var _reactHooks=require("@apollo/react-hooks");var _queries=require("../../queries");var _fns=require("../../fns");var _theme=require("../../theme");var _this=this,_jsxFileName="/Users/kane/Lab/Eros/src/containers/PhoneAuth/PhoneAuthClaimHandle.js";var PhoneAuthClaimHandle=function PhoneAuthClaimHandle(_ref){var onSuccess=_ref.onSuccess;var styles=useStyles();var _useQuery=(0,_reactHooks.useQuery)(_queries.ACCOUNT),accountData=_useQuery.data;var account=accountData&&accountData.account;var _useMutation=(0,_reactHooks.useMutation)(_queries.UPDATE_ACCOUNT),_useMutation2=(0,_slicedToArray2.default)(_useMutation,2),updateAccount=_useMutation2[0],updateResponse=_useMutation2[1];var updateLoading=updateResponse.loading;var _useLazyQuery=(0,_reactHooks.useLazyQuery)(_queries.HANDLE_IS_AVAILABLE),_useLazyQuery2=(0,_slicedToArray2.default)(_useLazyQuery,2),checkHandleIsAvailable=_useLazyQuery2[0],_useLazyQuery2$=_useLazyQuery2[1],data=_useLazyQuery2$.data,error=_useLazyQuery2$.error,loading=_useLazyQuery2$.loading;var handleIsAvailable=data&&data.handleIsAvailable;var initialHandle=account&&account.handle&&"@"+account.handle||'';var _useState=(0,_react.useState)(initialHandle),_useState2=(0,_slicedToArray2.default)(_useState,2),handle=_useState2[0],setHandle=_useState2[1];(0,_react.useEffect)(function(){if((0,_fns.isValidHandle)(handle.slice(1))){checkHandleIsAvailable({variables:{handle:handle.slice(1),display:handle.slice(1)}});}},[handle,checkHandleIsAvailable]);var submit=function submit(){var input,_await$updateAccount,data;return _regenerator.default.async(function submit$(_context){while(1){switch(_context.prev=_context.next){case 0:input={handle:handle.slice(1)};_context.next=3;return _regenerator.default.awrap(updateAccount({variables:{input:input}}));case 3:_await$updateAccount=_context.sent;data=_await$updateAccount.data;if(data&&data.UpdateAccount){onSuccess(data.UpdateAccount);}case 6:case"end":return _context.stop();}}},null,null,null,Promise);};var onHandle=function onHandle(text){if(text==='@'){return setHandle('');}if(text&&text[0]!=='@'){return setHandle("@"+text);}return setHandle(text);};var handleIsValid=(0,_fns.isValidHandle)(handle&&handle.slice(1));var handleIsMe=account&&account.handle===(handle&&handle.slice(1))||false;return _react.default.createElement(_components.Container,{style:styles.container,testID:"UpdateAccount",__self:_this,__source:{fileName:_jsxFileName,lineNumber:61,columnNumber:5}},_react.default.createElement(_components.View,{style:styles.titleContainer,__self:_this,__source:{fileName:_jsxFileName,lineNumber:62,columnNumber:7}},_react.default.createElement(_components.Title,{type:5,text:"Claim Your Handle",gutter:true,__self:_this,__source:{fileName:_jsxFileName,lineNumber:63,columnNumber:9}})),_react.default.createElement(_components.Row,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:66,columnNumber:7}},_react.default.createElement(_components.View,{style:{width:'100%'},__self:_this,__source:{fileName:_jsxFileName,lineNumber:67,columnNumber:9}},loading?_react.default.createElement(_components.ActivityIndicator,{size:12,style:{marginBottom:8},__self:_this,__source:{fileName:_jsxFileName,lineNumber:69,columnNumber:13}}):handleIsMe?_react.default.createElement(_components.Caption,{text:""+handle,gutter:true,__self:_this,__source:{fileName:_jsxFileName,lineNumber:71,columnNumber:13}}):handleIsValid&&handleIsAvailable?_react.default.createElement(_components.Caption,{text:handle+" is available",gutter:true,__self:_this,__source:{fileName:_jsxFileName,lineNumber:73,columnNumber:13}}):handle.length===0?_react.default.createElement(_components.Caption,{text:"Claim your handle",gutter:true,__self:_this,__source:{fileName:_jsxFileName,lineNumber:75,columnNumber:13}}):_react.default.createElement(_components.Caption,{text:handle+" has been taken",gutter:true,__self:_this,__source:{fileName:_jsxFileName,lineNumber:77,columnNumber:13}}),_react.default.createElement(_components.TextField,{testID:"PhoneAuthClaimHandleInput",onChangeText:onHandle,placeholder:"@",style:styles.textField,value:handle,__self:_this,__source:{fileName:_jsxFileName,lineNumber:79,columnNumber:11}}))),updateLoading&&_react.default.createElement(_components.ActivityIndicator,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:88,columnNumber:25}}),_react.default.createElement(_components.OutlinedButton,{testID:"PhoneAuthClaimHandlePrimaryButton",disabled:!_fns.isValidHandle,onPress:submit,text:"Save",style:styles.button,__self:_this,__source:{fileName:_jsxFileName,lineNumber:89,columnNumber:7}}));};exports.PhoneAuthClaimHandle=PhoneAuthClaimHandle;var useStyles=(0,_theme.makeStyles)(function(theme){return{container:{maxWidth:theme.FEED_WIDTH,paddingHorizontal:theme.unit*2,width:'100%',alignItems:'center'},button:{flex:1,marginTop:theme.unit*3.5,width:'100%'},textField:{marginBottom:theme.unit*2,width:'100%'},titleContainer:{width:'100%',textAlign:'center',alignItems:'center'}};});var _default=PhoneAuthClaimHandle;exports.default=_default;