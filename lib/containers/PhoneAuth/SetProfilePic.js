var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard");Object.defineProperty(exports,"__esModule",{value:true});exports.default=exports.SetProfilePic=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _react=_interopRequireWildcard(require("react"));var _components=require("../../components");var _reactHooks=require("@apollo/react-hooks");var _queries=require("../../queries");var _fns=require("../../fns");var _theme=require("../../theme");var _this=this,_jsxFileName="/Users/kane/Lab/Eros/src/containers/PhoneAuth/SetProfilePic.js";var initialState={display:'',handle:''};var SetProfilePic=function SetProfilePic(_ref){var onSuccess=_ref.onSuccess;var _useQuery=(0,_reactHooks.useQuery)(_queries.ACCOUNT),accountData=_useQuery.data;var account=accountData&&accountData.account;var _useMutation=(0,_reactHooks.useMutation)(_queries.UPDATE_ACCOUNT),_useMutation2=(0,_slicedToArray2.default)(_useMutation,2),updateAccount=_useMutation2[0],updateResponse=_useMutation2[1];var updateLoading=updateResponse.loading;var _useMutation3=(0,_reactHooks.useMutation)(_queries.UPDATE_PERSONA_AVATAR),_useMutation4=(0,_slicedToArray2.default)(_useMutation3,1),updatePersonaAvatar=_useMutation4[0];var _useMutation5=(0,_reactHooks.useMutation)(_queries.UPDATE_PERSONA_BANNER),_useMutation6=(0,_slicedToArray2.default)(_useMutation5,1),updatePersonaBanner=_useMutation6[0];var _useLazyQuery=(0,_reactHooks.useLazyQuery)(_queries.HANDLE_IS_AVAILABLE),_useLazyQuery2=(0,_slicedToArray2.default)(_useLazyQuery,2),checkHandleIsAvailable=_useLazyQuery2[0],_useLazyQuery2$=_useLazyQuery2[1],data=_useLazyQuery2$.data,error=_useLazyQuery2$.error,loading=_useLazyQuery2$.loading;var handleIsAvailable=data&&data.handleIsAvailable;var initialDisplay=account&&account.display||'';var _useState=(0,_react.useState)(initialDisplay),_useState2=(0,_slicedToArray2.default)(_useState,2),display=_useState2[0],setDisplay=_useState2[1];var initialHandle=account&&account.handle&&"@"+account.handle||'';var _useState3=(0,_react.useState)(initialHandle),_useState4=(0,_slicedToArray2.default)(_useState3,2),handle=_useState4[0],setHandle=_useState4[1];var onAvatarFiles=function onAvatarFiles(images){var options,_await$updatePersonaA,data;return _regenerator.default.async(function onAvatarFiles$(_context){while(1){switch(_context.prev=_context.next){case 0:options={variables:{image:images[0]}};_context.next=3;return _regenerator.default.awrap(updatePersonaAvatar(options));case 3:_await$updatePersonaA=_context.sent;data=_await$updatePersonaA.data;if(data)alert("NEW URI "+data);case 6:case"end":return _context.stop();}}},null,null,null,Promise);};var onBannerFiles=function onBannerFiles(images){var options,_await$updatePersonaB,data;return _regenerator.default.async(function onBannerFiles$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:options={variables:{image:images[0]}};_context2.next=3;return _regenerator.default.awrap(updatePersonaBanner(options));case 3:_await$updatePersonaB=_context2.sent;data=_await$updatePersonaB.data;if(data)alert("NEW URI "+data);case 6:case"end":return _context2.stop();}}},null,null,null,Promise);};(0,_react.useEffect)(function(){if((0,_fns.isValidHandle)(handle.slice(1))){checkHandleIsAvailable({variables:{handle:handle.slice(1)}});}},[handle,checkHandleIsAvailable]);var submit=function submit(){var input,_await$updateAccount,data;return _regenerator.default.async(function submit$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:input={handle:handle.slice(1),display:display};_context3.next=3;return _regenerator.default.awrap(updateAccount({variables:{input:input}}));case 3:_await$updateAccount=_context3.sent;data=_await$updateAccount.data;if(data&&data.UpdateAccount){onSuccess(data.UpdateAccount);}case 6:case"end":return _context3.stop();}}},null,null,null,Promise);};var handleIsValid=(0,_fns.isValidHandle)(handle&&handle.slice(1));var handleIsMe=account.handle===(handle&&handle.slice(1));var handleIsAvailableAndValid=handleIsAvailable&&handleIsValid&&display.length>1;var isValid=handleIsAvailableAndValid||handleIsMe;return _react.default.createElement(_components.Container,{style:styles.container,testID:"UpdateAccount",__self:_this,__source:{fileName:_jsxFileName,lineNumber:86,columnNumber:5}},_react.default.createElement(_components.Banner,{uri:account&&account.bannerUrl,__self:_this,__source:{fileName:_jsxFileName,lineNumber:87,columnNumber:7}},_react.default.createElement(_components.ImageUploadButton,{style:{backgroundColor:_theme.canvasOpaque},hoverStyle:{backgroundColor:_theme.canvas3Opaque},iconName:"ios-camera",onFiles:onBannerFiles,__self:_this,__source:{fileName:_jsxFileName,lineNumber:88,columnNumber:9}})),_react.default.createElement(_components.View,{style:styles.row,__self:_this,__source:{fileName:_jsxFileName,lineNumber:95,columnNumber:7}},_react.default.createElement(_components.View,{style:{height:90,width:90,borderRadius:90,marginRight:16,alignItems:'center',justifyContent:'center'},__self:_this,__source:{fileName:_jsxFileName,lineNumber:96,columnNumber:9}},_react.default.createElement(_components.ImageUploadButton,{style:{backgroundColor:_theme.canvasOpaque},hoverStyle:{backgroundColor:_theme.canvas3Opaque},iconName:"ios-camera",onFiles:onAvatarFiles,__self:_this,__source:{fileName:_jsxFileName,lineNumber:106,columnNumber:11}}),_react.default.createElement(_components.Avatar,{size:90,avatarUrl:account&&account.avatarUrl,style:{padding:0,position:'absolute',zIndex:-1},__self:_this,__source:{fileName:_jsxFileName,lineNumber:112,columnNumber:11}}))),updateLoading&&_react.default.createElement(_components.ActivityIndicator,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:120,columnNumber:25}}),_react.default.createElement(_components.Container,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:122,columnNumber:7}},_react.default.createElement(_components.OutlinedButton,{testID:"UpdateAccountPrimaryButton",disabled:!isValid,onPress:submit,text:"SKIP",style:styles.button,__self:_this,__source:{fileName:_jsxFileName,lineNumber:123,columnNumber:9}})));};exports.SetProfilePic=SetProfilePic;var useStyles=(0,_theme.makeStyles)(function(theme){return{container:{maxWidth:_theme.FEED_WIDTH,paddingHorizontal:_theme.unit*2,width:'100%',alignItems:'center'},button:{flex:1,width:'100%'},textField:{marginBottom:_theme.unit*2},row:{width:'100%',paddingVertical:_theme.unit*2,flexDirection:'row'},banner:{}};});var _default=SetProfilePic;exports.default=_default;